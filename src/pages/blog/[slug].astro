---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';
import SchemaArticle from '../../components/SchemaArticle.astro';
import '../../styles/global.css';

export const getStaticPaths = (async () => {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content } = await entry.render();
const { title, description, pubDate, image, tags, categories } = entry.data;
const fullURL = new URL(Astro.url.pathname, Astro.site).toString();
---

<BaseLayout title={title} description={description} image={image}>
  <SchemaArticle 
    slot="schema"
    title={title}
    description={description}
    image={image}
    pubDate={pubDate}
    url={fullURL}
    categories={categories}
  />
  <Navbar slot="navbar" />
  
  <article class="container mx-auto px-4 py-12">
    <div class="max-w-3xl mx-auto">
      {/* Header */}
      <header class="mb-8">
        <h1 class="text-4xl md:text-5xl font-bold mb-4" style="color: var(--color-text-primary);">
          {title}
        </h1>
        
        <div class="flex items-center gap-4 text-sm mb-6" style="color: var(--color-text-muted);">
          <time datetime={pubDate.toISOString()}>
            {pubDate.toLocaleDateString('th-TH', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            })}
          </time>
          {categories.length > 0 && (
            <span>• {categories.join(', ')}</span>
          )}
        </div>

        {/* Tags */}
        {tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-6">
            {tags.map((tag) => (
              <span 
                class="px-3 py-1 text-sm rounded-full"
                style="background-color: var(--color-bg-secondary); color: var(--color-text-muted);"
              >
                {tag}
              </span>
            ))}
          </div>
        )}

        {/* Featured Image */}
        {image && (
          <img 
            src={image} 
            alt={title}
            class="w-full rounded-lg mb-8"
            style="box-shadow: var(--shadow-card);"
          />
        )}
      </header>

      {/* Content */}
      <div class="prose prose-lg max-w-none blog-content">
        <Content />
      </div>

      {/* Back to Blog */}
      <div class="mt-12 pt-8 border-t" style="border-color: var(--color-border-light);">
        <a 
          href="/" 
          class="inline-flex items-center gap-2 hover:underline"
          style="color: var(--color-link-primary);"
        >
          ← Back to all posts
        </a>
      </div>
    </div>
  </article>

  <Footer slot="footer" />
</BaseLayout>

<style is:global>
  .blog-content {
    max-width: 720px;
    margin: 0 auto;
    font-size: 1.25rem;
    line-height: 1.75;
    font-weight: 300;
    color: var(--color-text-primary);
  }

  .blog-content strong {
    font-weight: 500;
  }
  
  .blog-content em {
    background-color: #ffeb3b;
    font-style: italic;
    padding: 0 0.2em;
  }
  
  [data-theme="dark"] .blog-content em {
    background-color: rgba(255, 235, 59, 0.3);
  }

  .blog-content h2 {
    color: var(--color-text-primary);
    font-size: 2rem;
    font-weight: 600;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.3;
  }

  .blog-content h3 {
    color: var(--color-text-primary);
    font-size: 1.75rem;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }
  
  .blog-content h4 {
    color: var(--color-text-primary);
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .blog-content p {
    margin-bottom: 1.5rem;
  }

  .blog-content ul,
  .blog-content ol {
    margin-bottom: 1.5rem;
    padding-left: 2rem;
  }

  .blog-content li {
    margin-bottom: 0.5rem;
  }

  .blog-content a {
    color: var(--color-link-primary);
    text-decoration: underline;
  }

  .blog-content a:hover {
    color: var(--color-link-hover);
  }

  .blog-content img {
    max-width: 100%;
    height: auto;
    margin: 2rem auto;
    border-radius: 0.5rem;
    box-shadow: var(--shadow-card);
  }

  .blog-content blockquote {
    border-left: 4px solid var(--color-border-card);
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--color-text-muted);
  }

  .blog-content code {
    font-family: Monaco, Courier, monospace;
    background-color: var(--color-bg-secondary);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.9em;
  }

  .blog-content pre {
    background-color: var(--color-bg-secondary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
  }

  .blog-content pre code {
    background-color: transparent;
    padding: 0;
    font-size: 0.9rem;
  }

  .blog-content hr {
    border: none;
    text-align: center;
    margin: 2.5rem 0;
    height: 1.5rem;
  }
  
  .blog-content hr::before {
    content: '• • •';
    color: var(--color-text-muted);
    font-size: 1.5rem;
    letter-spacing: 1rem;
    margin-left: 0.5rem;
  }
  
  .blog-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
  }
  
  .blog-content th,
  .blog-content td {
    border: 1px solid var(--color-border-card);
    padding: 0.75rem;
    text-align: left;
  }
  
  .blog-content th {
    background-color: var(--color-bg-secondary);
    font-weight: 600;
  }
</style>
