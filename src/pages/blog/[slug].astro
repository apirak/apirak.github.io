---
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import SchemaArticle from "../../components/SchemaArticle.astro";
import Comments from "../../components/Comments.astro";
import "../../styles/global.css";
import "../../styles/blog.css";

export const getStaticPaths = (async () => {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content } = await entry.render();
const { title, description, pubDate, image, tags, categories } = entry.data;
const fullURL = new URL(Astro.url.pathname, Astro.site).toString();
---

<BaseLayout title={title} description={description} image={image}>
  <SchemaArticle
    slot="schema"
    title={title}
    description={description}
    image={image}
    pubDate={pubDate}
    url={fullURL}
    categories={categories}
  />
  <Navbar slot="navbar" />

  <article class="container mx-auto px-4 py-12">
    <div class="max-w-3xl mx-auto">
      {/* Header */}
      <header class="mb-8">
        <h1
          class="text-4xl md:text-5xl font-bold mb-4"
          style="color: var(--color-text-primary);"
        >
          {title}
        </h1>

        <div
          class="flex items-center gap-4 text-sm mb-6"
          style="color: var(--color-text-muted);"
        >
          <time datetime={pubDate.toISOString()}>
            {
              pubDate.toLocaleDateString("th-TH", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })
            }
          </time>
          {categories.length > 0 && <span>• {categories.join(", ")}</span>}
        </div>

        {/* Tags */}
        {
          tags.length > 0 && (
            <div class="flex flex-wrap gap-2 mb-6">
              {tags.map((tag) => (
                <span
                  class="px-3 py-1 text-sm rounded-full"
                  style="background-color: var(--color-bg-secondary); color: var(--color-text-muted);"
                >
                  {tag}
                </span>
              ))}
            </div>
          )
        }

        {/* Featured Image */}
        {
          image && (
            <img
              src={image}
              alt={title}
              class="w-full rounded-lg mb-8"
              style="box-shadow: var(--shadow-card);"
            />
          )
        }
      </header>

      {/* Content */}
      <div class="prose prose-lg max-w-none blog-content">
        <Content />
      </div>

      {/* Back to Blog */}
      <div
        class="mt-12 pt-8 border-t"
        style="border-color: var(--color-border-light);"
      >
        <a
          href="/"
          class="inline-flex items-center gap-2 hover:underline"
          style="color: var(--color-link-primary);"
        >
          ← Back to all posts
        </a>
      </div>

      {/* Comments Section */}
      <Comments />
    </div>
  </article>

  <Footer slot="footer" />
</BaseLayout>
